undoing pawn promotion keeps piece as queen

queen doesn't pin properly on diagonals (works fine for pawns)

bug in king moves under check